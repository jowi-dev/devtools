# Tmux Configuration
# Optimized for Neovim key bindings (Ctrl+1-9 and Alt+1-9)

# ============================================
# Key Binding Configuration for Neovim
# ============================================

# Enable proper Alt/Option key handling
# This allows Alt+number keys to work in Neovim
set-option -g assume-paste-time 0
set-option -sg escape-time 10

# Unbind Ctrl+number keys (tmux uses these for window switching by default)
# These may not exist in all tmux versions, so ignore errors
unbind-key -n C-1 2>/dev/null
unbind-key -n C-2 2>/dev/null
unbind-key -n C-3 2>/dev/null
unbind-key -n C-4 2>/dev/null
unbind-key -n C-5 2>/dev/null
unbind-key -n C-6 2>/dev/null
unbind-key -n C-7 2>/dev/null
unbind-key -n C-8 2>/dev/null
unbind-key -n C-9 2>/dev/null

# Enable xterm-style function key sequences
set-window-option -g xterm-keys on

# ============================================
# Terminal Settings
# ============================================

# Set terminal to support 256 colors and true color
# Use tmux-256color for better key support
set-option -g default-terminal "tmux-256color"
set-option -sa terminal-overrides ',xterm-256color:RGB'
set-option -sa terminal-overrides ',*:Tc'

# Enable focus events (helps Neovim detect focus changes)
set-option -g focus-events on

# ============================================
# General Tmux Settings
# ============================================

# Set prefix to Ctrl-a (more ergonomic than Ctrl-b)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support
set-option -g mouse on

# Start window and pane numbering at 1 instead of 0
set-option -g base-index 1
set-window-option -g pane-base-index 1

# Renumber windows when one is closed
set-option -g renumber-windows on

# Increase scrollback buffer size
set-option -g history-limit 50000

# Display tmux messages for 4 seconds
set-option -g display-time 4000

# Refresh status bar every 5 seconds
set-option -g status-interval 5

# ============================================
# Window and Pane Navigation
# ============================================

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Reload config file
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Switch windows with Alt+arrow (without prefix)
bind -n M-Left previous-window
bind -n M-Right next-window

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ============================================
# Copy Mode (Vi-style)
# ============================================

# Use vi mode
set-window-option -g mode-keys vi

# Vi-style copy/paste
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ============================================
# Status Bar Configuration
# ============================================

# Status bar position
set-option -g status-position bottom

# Status bar colors
set-option -g status-style bg=colour235,fg=colour136

# Window status
set-window-option -g window-status-style fg=colour244
set-window-option -g window-status-current-style fg=colour166,bold

# Pane border colors
set-option -g pane-border-style fg=colour235
set-option -g pane-active-border-style fg=colour136

# Message colors
set-option -g message-style bg=colour235,fg=colour166

# Status bar content
set-option -g status-left-length 32
set-option -g status-left '#[fg=colour235,bg=colour136,bold] #S #[default] '
set-option -g status-right '#[fg=colour244] %Y-%m-%d %H:%M '

# ============================================
# Compatibility Notes
# ============================================

# For macOS users: If Alt keys still don't work, check your terminal emulator settings:
# - iTerm2: Preferences > Profiles > Keys > Left/Right Option key: "Esc+"
# - Terminal.app: Preferences > Profiles > Keyboard > "Use Option as Meta key"
# - Alacritty: Add to alacritty.yml:
#   key_bindings:
#     - { key: Key1, mods: Alt, chars: "\x1b1" }
#     (repeat for keys 2-9)
